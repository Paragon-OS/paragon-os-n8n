
> paragon-os-n8n@1.0.0 test:backup-restore
> ./scripts/test-integration.sh backup

[1;33mğŸ§¹ Cleaning up test containers...[0m
[0;32mâœ… Cleanup complete[0m
[0;32mğŸš€ Starting integration tests...[0m
[0;34mTest: src/tests/integration/backup-restore.test.ts[0m
[0;34mWatch: false[0m
[0;34mLog: false[0m

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent

{"level":30,"time":1765549975017,"pid":47930,"msg":"Finding available port..."}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests
ğŸš€ Starting shared n8n instance for all tests...

{"level":30,"time":1765549975018,"pid":47930,"msg":"Using auto-selected port: 50000"}
{"level":30,"time":1765549975018,"pid":47930,"msg":"Starting n8n instance: n8n-test-1765549975016-6zlgjp on port 50000"}
{"level":30,"time":1765549975018,"pid":47930,"msg":"Step 1: Cleaning up any existing container..."}
{"level":30,"time":1765549975231,"pid":47930,"msg":"âœ… Cleanup complete"}
{"level":30,"time":1765549975231,"pid":47930,"msg":"Step 2: Checking if n8n image exists locally: n8nio/n8n:latest..."}
{"level":30,"time":1765549975442,"pid":47930,"msg":"âœ… Image already exists locally"}
{"level":30,"time":1765549975442,"pid":47930,"msg":"Step 3: Building container configuration..."}
{"level":30,"time":1765549975442,"pid":47930,"msg":"Step 4: Starting container..."}
{"level":30,"time":1765549975442,"pid":47930,"msg":"Executing: podman run -d --name n8n-test-1765549975016-6zlgjp -p 50000:5678 ..."}
{"level":30,"time":1765549975759,"pid":47930,"msg":"âœ… Container started: 1737f8a1fbbe162a5936bc22a463ada976e2dc9879e58d500ae176349a8c5d3b"}
{"level":30,"time":1765549975759,"pid":47930,"msg":"Step 5: Waiting for n8n to be ready at http://localhost:50000..."}
{"level":30,"time":1765549975760,"pid":47930,"msg":"â³ Waiting for n8n container to be ready at http://localhost:50000 (timeout: 120000ms)..."}
{"level":30,"time":1765549977787,"pid":47930,"msg":"âœ… n8n container is ready at http://localhost:50000 (took 2s)"}
{"level":30,"time":1765549977787,"pid":47930,"msg":"Step 6: Setting up n8n user, API key, and credentials..."}
{"level":30,"time":1765549977807,"pid":47930,"msg":"ğŸš€ Setting up n8n with user, session cookie, and credentials..."}
{"level":30,"time":1765549977807,"pid":47930,"msg":"Step 1: Setting up user and session cookie..."}
{"level":30,"time":1765549977807,"pid":47930,"msg":"ğŸ”§ Setting up n8n user and session cookie at http://localhost:50000"}
{"level":30,"time":1765549977807,"pid":47930,"msg":"â³ Waiting for n8n DB migrations to complete (timeout: 90000ms)..."}
{"level":30,"time":1765549981558,"pid":47930,"msg":"âœ… DB migrations complete (took 3s)"}
{"level":30,"time":1765549981558,"pid":47930,"msg":"Checking if REST API is responding..."}
{"level":30,"time":1765549982569,"pid":47930,"msg":"Creating initial user: test@n8n.test"}
{"level":30,"time":1765549982569,"pid":47930,"msg":"User creation attempt 1/3..."}
{"level":30,"time":1765549982698,"pid":47930,"msg":"Setup response: status=200"}
{"level":40,"time":1765549982699,"pid":47930,"msg":"User creation response missing user ID, but status was 200"}
{"level":40,"time":1765549982699,"pid":47930,"msg":"Response structure: data"}
{"level":30,"time":1765549982699,"pid":47930,"msg":"Waiting 2 seconds for user to be persisted..."}
{"level":30,"time":1765549984699,"pid":47930,"msg":"Logging in to get session cookie..."}
{"level":30,"time":1765549984829,"pid":47930,"msg":"Cookies received: 1 cookie(s)"}
{"level":30,"time":1765549984829,"pid":47930,"msg":"âœ… Session cookie obtained for authentication"}
{"level":30,"time":1765549984829,"pid":47930,"msg":"â„¹ï¸  API key creation skipped - session cookie is sufficient for all operations via /rest endpoints"}
{"level":30,"time":1765549984829,"pid":47930,"msg":"âœ… User and session cookie setup complete"}
{"level":30,"time":1765549984829,"pid":47930,"msg":"â„¹ï¸  Using session cookie authentication (API key not needed)"}
{"level":30,"time":1765549984829,"pid":47930,"msg":"Step 2: Checking n8n CLI availability..."}
{"level":30,"time":1765549986152,"pid":47930,"msg":"âœ… n8n CLI is available"}
{"level":30,"time":1765549986152,"pid":47930,"msg":"Step 3: Setting up credentials via CLI..."}
{"level":30,"time":1765549986152,"pid":47930,"msg":"ğŸ” Setting up essential credentials for testing..."}
{"level":30,"time":1765549986152,"pid":47930,"msg":"Setting up credential: Google Gemini(PaLM) Api account (NIhZoi9otQV2vaAP)"}
{"level":30,"time":1765549986153,"pid":47930,"msg":"Importing credential via CLI: /var/folders/vl/vh9bz_zs0d9bxgtb92wch_800000gn/T/n8n-test-instances/n8n-test-1765549975016-6zlgjp/.n8n-credentials/credential-NIhZoi9otQV2vaAP.json"}
{"level":30,"time":1765549988279,"pid":47930,"msg":"âœ… Google Gemini(PaLM) Api account setup complete"}
{"level":30,"time":1765549988279,"pid":47930,"msg":"Setting up credential: Redis account (I9K02BUMIbHYp1nQ)"}
{"level":30,"time":1765549988280,"pid":47930,"msg":"Importing credential via CLI: /var/folders/vl/vh9bz_zs0d9bxgtb92wch_800000gn/T/n8n-test-instances/n8n-test-1765549975016-6zlgjp/.n8n-credentials/credential-I9K02BUMIbHYp1nQ.json"}
{"level":30,"time":1765549990413,"pid":47930,"msg":"âœ… Redis account setup complete"}
{"level":30,"time":1765549990413,"pid":47930,"msg":"Setting up credential: QdrantApi account (ytBh4xOzWNQ347S5)"}
{"level":30,"time":1765549990414,"pid":47930,"msg":"Importing credential via CLI: /var/folders/vl/vh9bz_zs0d9bxgtb92wch_800000gn/T/n8n-test-instances/n8n-test-1765549975016-6zlgjp/.n8n-credentials/credential-ytBh4xOzWNQ347S5.json"}
{"level":30,"time":1765549992655,"pid":47930,"msg":"âœ… QdrantApi account setup complete"}
{"level":30,"time":1765549992655,"pid":47930,"msg":"Setting up credential: Header Auth account (S0nticGtHhYu1fe4)"}
{"level":30,"time":1765549992655,"pid":47930,"msg":"Importing credential via CLI: /var/folders/vl/vh9bz_zs0d9bxgtb92wch_800000gn/T/n8n-test-instances/n8n-test-1765549975016-6zlgjp/.n8n-credentials/credential-S0nticGtHhYu1fe4.json"}
{"level":30,"time":1765549995013,"pid":47930,"msg":"âœ… Header Auth account setup complete"}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests
âœ… Shared instance ready: http://localhost:50000

{"level":30,"time":1765549995013,"pid":47930,"msg":"\nğŸ“Š Credential Setup Summary:"}
{"level":30,"time":1765549995013,"pid":47930,"msg":"  âœ… Successful: 4/4"}
{"level":30,"time":1765549995014,"pid":47930,"msg":"âœ… Credentials setup complete"}
{"level":30,"time":1765549995014,"pid":47930,"msg":"ğŸ‰ n8n setup complete!"}
{"level":30,"time":1765549995014,"pid":47930,"msg":"âœ… n8n setup complete with session cookie authentication"}
{"level":30,"time":1765549995014,"pid":47930,"msg":"âœ… n8n instance ready: http://localhost:50000"}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should backup and restore simple workflows
ğŸ”„ Resetting n8n state for next test...

{"level":30,"time":1765549995023,"pid":47930,"msg":"ğŸ”„ Resetting n8n instance state..."}
{"level":30,"time":1765549995023,"pid":47930,"msg":"Clearing all workflows from n8n instance at http://localhost:50000..."}
{"level":30,"time":1765549995023,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995024,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995049,"pid":47930,"msg":"Found 0 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995049,"pid":47930,"msg":"Total workflows fetched with full data: 0"}
{"level":30,"time":1765549995049,"pid":47930,"msg":"âœ… Deleted 0 workflow(s)"}
{"level":30,"time":1765549995049,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995049,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995056,"pid":47930,"msg":"Found 0 workflow(s) in summary, fetching full data for each..."}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should backup and restore simple workflows
âœ… State reset complete

{"level":30,"time":1765549995056,"pid":47930,"msg":"Total workflows fetched with full data: 0"}
{"level":30,"time":1765549995056,"pid":47930,"msg":"âœ… n8n instance state reset complete"}
{"level":30,"time":1765549995056,"pid":47930,"msg":"\nğŸ“ Step 1: Creating 2 test workflow(s)..."}
{"level":30,"time":1765549995056,"pid":47930,"msg":"Creating 2 test workflow(s) in n8n instance at http://localhost:50000..."}
{"level":30,"time":1765549995056,"pid":47930,"msg":"Instance auth: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995056,"pid":47930,"msg":"Importing workflow \"Simple Workflow 1\" to http://localhost:50000..."}
{"level":30,"time":1765549995056,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995056,"pid":47930,"msg":"API config: baseURL=http://localhost:50000, apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995057,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995057,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995057,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995057,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":30,"time":1765549995065,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995072,"pid":47930,"msg":"Found 0 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995072,"pid":47930,"msg":"Total workflows fetched with full data: 0"}
{"level":30,"time":1765549995073,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995079,"pid":47930,"msg":"Found 0 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995079,"pid":47930,"msg":"Total workflows fetched with full data: 0"}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Successfully imported workflow: Simple Workflow 1 (ID: qIII1VhLAyQfnjIq)"}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Importing workflow \"Simple Workflow 2\" to http://localhost:50000..."}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995107,"pid":47930,"msg":"API config: baseURL=http://localhost:50000, apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":30,"time":1765549995107,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995116,"pid":47930,"msg":"Found 1 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995129,"pid":47930,"msg":"Total workflows fetched with full data: 1"}
{"level":30,"time":1765549995129,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995135,"pid":47930,"msg":"Found 1 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995145,"pid":47930,"msg":"Total workflows fetched with full data: 1"}
{"level":30,"time":1765549995163,"pid":47930,"msg":"Successfully imported workflow: Simple Workflow 2 (ID: e1cuvMOI2XFVkW2F)"}
{"level":30,"time":1765549995163,"pid":47930,"msg":"âœ… Created 2 test workflow(s)"}
{"level":30,"time":1765549995163,"pid":47930,"msg":"\nğŸ’¾ Step 2: Running backup to /var/folders/vl/vh9bz_zs0d9bxgtb92wch_800000gn/T/backup-test-1765549995056-zjeij..."}
{"level":30,"time":1765549995205,"pid":47930,"msg":"ğŸ“¦ Backup target: /var/folders/vl/vh9bz_zs0d9bxgtb92wch_800000gn/T/backup-test-1765549995056-zjeij"}
{"level":30,"time":1765549995205,"pid":47930,"msg":"   This will export all workflows from n8n to the backup directory.\n"}
{"level":30,"time":1765549995205,"pid":47930,"msg":""}
{"level":30,"time":1765549995205,"pid":47930,"msg":"Fetching workflows from n8n..."}
{"level":30,"time":1765549995205,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995216,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995272,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":30,"time":1765549995272,"pid":47930,"msg":"Fetched 2 workflow(s) from n8n."}
{"level":30,"time":1765549995274,"pid":47930,"msg":"Exported 2 workflow(s) to temp directory"}
{"level":30,"time":1765549995274,"pid":47930,"msg":"Renaming workflows to human-readable names..."}
{"level":30,"time":1765549995285,"pid":47930,"msg":"Syncing workflow references..."}
{"level":30,"time":1765549995285,"pid":47930,"msg":"Syncing workflow references to match n8n IDs..."}
{"level":30,"time":1765549995285,"pid":47930,"n8nWorkflowCount":2,"msg":"ğŸ“‹ Starting workflow reference sync..."}
{"level":30,"time":1765549995286,"pid":47930,"msg":"   Checking 2 workflow file(s) for references"}
{"level":30,"time":1765549995286,"pid":47930,"msg":"âœ“ All workflow references are already in sync with n8n"}
{"level":30,"time":1765549995286,"pid":47930,"msg":"Replacing workflows directory..."}
{"level":30,"time":1765549995286,"pid":47930,"msg":"âœ“ Workflows directory updated"}
{"level":30,"time":1765549995286,"pid":47930,"msg":""}
{"level":30,"time":1765549995286,"pid":47930,"msg":"âœ… Backup completed successfully!"}
{"level":30,"time":1765549995286,"pid":47930,"msg":"   2 workflow(s) backed up to /var/folders/vl/vh9bz_zs0d9bxgtb92wch_800000gn/T/backup-test-1765549995056-zjeij"}
{"level":30,"time":1765549995287,"pid":47930,"msg":"âœ… Backup created 2 file(s)"}
{"level":30,"time":1765549995287,"pid":47930,"msg":"\nğŸ—‘ï¸  Step 3: Clearing n8n instance..."}
{"level":30,"time":1765549995287,"pid":47930,"msg":"Clearing all workflows from n8n instance at http://localhost:50000..."}
{"level":30,"time":1765549995287,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995287,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995295,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995317,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995339,"pid":47930,"msg":"Failed to delete workflow qIII1VhLAyQfnjIq (Simple Workflow 1): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":40,"time":1765549995348,"pid":47930,"msg":"Failed to delete workflow e1cuvMOI2XFVkW2F (Simple Workflow 2): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995348,"pid":47930,"msg":"âœ… Deleted 0 workflow(s)"}
{"level":30,"time":1765549995348,"pid":47930,"msg":"\nğŸ“¥ Step 4: Running restore..."}
{"level":30,"time":1765549995391,"pid":47930,"msg":"Checking n8n connection..."}
{"level":30,"time":1765549995391,"pid":47930,"msg":"Creating API client for http://localhost:50000/api/v1"}
{"level":30,"time":1765549995391,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=missing"}
{"level":40,"time":1765549995391,"pid":47930,"msg":"No authentication method available - API calls will likely fail"}
{"level":30,"time":1765549995401,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995412,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995436,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":30,"time":1765549995438,"pid":47930,"total":2,"unchanged":2,"toImport":0,"new":0,"msg":"Found 2 workflow JSON file(s) in backup. Unchanged on server (skipped): 2. New or changed (to import): 0 (including 0 without existing live workflows)."}
{"level":30,"time":1765549995438,"pid":47930,"msg":"All workflows in the backup already match the current n8n instance. Nothing to restore."}
{"level":30,"time":1765549995438,"pid":47930,"msg":"\nâœ… Step 5: Verifying workflows..."}
{"level":30,"time":1765549995438,"pid":47930,"msg":"Verifying workflows match after restore (http://localhost:50000)..."}
{"level":30,"time":1765549995438,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995438,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995446,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995464,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":30,"time":1765549995465,"pid":47930,"msg":"âœ… All workflows verified successfully"}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should backup and restore simple workflows

ğŸ“Š Test Result Summary:
   Success: true
   Errors: 0
   Warnings: 0
   Stats:
     - Workflows backed up: 2
     - Workflows restored: 2
     - Workflows verified: 2

{"level":30,"time":1765549995465,"pid":47930,"msg":"\nğŸ‰ Backup/restore test completed successfully!"}
{"level":30,"time":1765549995465,"pid":47930,"msg":"ğŸ“Š Test Statistics:"}
{"level":30,"time":1765549995465,"pid":47930,"msg":"   - Workflows backed up: 2"}
{"level":30,"time":1765549995465,"pid":47930,"msg":"   - Workflows restored: 2"}
{"level":30,"time":1765549995465,"pid":47930,"msg":"   - Workflows verified: 2"}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should backup and restore workflows with references
ğŸ”„ Resetting n8n state for next test...

{"level":30,"time":1765549995469,"pid":47930,"msg":"ğŸ”„ Resetting n8n instance state..."}
{"level":30,"time":1765549995469,"pid":47930,"msg":"Clearing all workflows from n8n instance at http://localhost:50000..."}
{"level":30,"time":1765549995469,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995469,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995475,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995493,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995500,"pid":47930,"msg":"Failed to delete workflow qIII1VhLAyQfnjIq (Simple Workflow 1): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":40,"time":1765549995506,"pid":47930,"msg":"Failed to delete workflow e1cuvMOI2XFVkW2F (Simple Workflow 2): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995506,"pid":47930,"msg":"âœ… Deleted 0 workflow(s)"}
{"level":30,"time":1765549995506,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995506,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995512,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995529,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995529,"pid":47930,"msg":"âš ï¸  2 workflow(s) still present after reset"}
{"level":30,"time":1765549995529,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995529,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995529,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995529,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995535,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow qIII1VhLAyQfnjIq"}
{"level":50,"time":1765549995535,"pid":47930,"msg":"Failed to force-delete workflow qIII1VhLAyQfnjIq: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995535,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995535,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995535,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995535,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995543,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow e1cuvMOI2XFVkW2F"}
{"level":50,"time":1765549995543,"pid":47930,"msg":"Failed to force-delete workflow e1cuvMOI2XFVkW2F: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995543,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995549,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995567,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":50,"time":1765549995568,"pid":47930,"err":{"type":"Error","message":"Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2","stack":"Error: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2\n    at Module.resetN8nState (/Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/utils/backup-restore-test.ts:719:15)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at /Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/tests/integration/backup-restore.test.ts:88:5\n    at callSuiteHook (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:964:22)\n    at runTest (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1040:30)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runFiles (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1262:5)\n    at startTests (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1271:3)\n    at file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11"},"msg":"Failed to reset n8n state:"}
{"level":30,"time":1765549995570,"pid":47930,"msg":"ğŸ”„ Resetting n8n instance state..."}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should handle multiple restore cycles without duplicates
ğŸ”„ Resetting n8n state for next test...

{"level":30,"time":1765549995570,"pid":47930,"msg":"Clearing all workflows from n8n instance at http://localhost:50000..."}
{"level":30,"time":1765549995570,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995571,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995579,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995595,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995604,"pid":47930,"msg":"Failed to delete workflow qIII1VhLAyQfnjIq (Simple Workflow 1): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":40,"time":1765549995610,"pid":47930,"msg":"Failed to delete workflow e1cuvMOI2XFVkW2F (Simple Workflow 2): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995610,"pid":47930,"msg":"âœ… Deleted 0 workflow(s)"}
{"level":30,"time":1765549995610,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995610,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995616,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995634,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995634,"pid":47930,"msg":"âš ï¸  2 workflow(s) still present after reset"}
{"level":30,"time":1765549995634,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995634,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995634,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995634,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995640,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow qIII1VhLAyQfnjIq"}
{"level":50,"time":1765549995640,"pid":47930,"msg":"Failed to force-delete workflow qIII1VhLAyQfnjIq: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995640,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995640,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995640,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995640,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995646,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow e1cuvMOI2XFVkW2F"}
{"level":50,"time":1765549995646,"pid":47930,"msg":"Failed to force-delete workflow e1cuvMOI2XFVkW2F: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995646,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995651,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995668,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":50,"time":1765549995668,"pid":47930,"err":{"type":"Error","message":"Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2","stack":"Error: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2\n    at Module.resetN8nState (/Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/utils/backup-restore-test.ts:719:15)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at /Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/tests/integration/backup-restore.test.ts:88:5\n    at callSuiteHook (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:964:22)\n    at runTest (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1040:30)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runFiles (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1262:5)\n    at startTests (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1271:3)\n    at file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11"},"msg":"Failed to reset n8n state:"}
{"level":30,"time":1765549995670,"pid":47930,"msg":"ğŸ”„ Resetting n8n instance state..."}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should handle empty backup restore gracefully
ğŸ”„ Resetting n8n state for next test...

{"level":30,"time":1765549995670,"pid":47930,"msg":"Clearing all workflows from n8n instance at http://localhost:50000..."}
{"level":30,"time":1765549995670,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995670,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995677,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995693,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995700,"pid":47930,"msg":"Failed to delete workflow qIII1VhLAyQfnjIq (Simple Workflow 1): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":40,"time":1765549995706,"pid":47930,"msg":"Failed to delete workflow e1cuvMOI2XFVkW2F (Simple Workflow 2): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995706,"pid":47930,"msg":"âœ… Deleted 0 workflow(s)"}
{"level":30,"time":1765549995706,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995706,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995713,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995729,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995730,"pid":47930,"msg":"âš ï¸  2 workflow(s) still present after reset"}
{"level":30,"time":1765549995730,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995730,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995730,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995730,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995735,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow qIII1VhLAyQfnjIq"}
{"level":50,"time":1765549995735,"pid":47930,"msg":"Failed to force-delete workflow qIII1VhLAyQfnjIq: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995735,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995735,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995735,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995735,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995741,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow e1cuvMOI2XFVkW2F"}
{"level":50,"time":1765549995741,"pid":47930,"msg":"Failed to force-delete workflow e1cuvMOI2XFVkW2F: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995741,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995748,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995764,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should preserve complex workflow structure
ğŸ”„ Resetting n8n state for next test...

{"level":50,"time":1765549995764,"pid":47930,"err":{"type":"Error","message":"Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2","stack":"Error: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2\n    at Module.resetN8nState (/Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/utils/backup-restore-test.ts:719:15)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at /Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/tests/integration/backup-restore.test.ts:88:5\n    at callSuiteHook (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:964:22)\n    at runTest (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1040:30)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runFiles (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1262:5)\n    at startTests (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1271:3)\n    at file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11"},"msg":"Failed to reset n8n state:"}
{"level":30,"time":1765549995766,"pid":47930,"msg":"ğŸ”„ Resetting n8n instance state..."}
{"level":30,"time":1765549995766,"pid":47930,"msg":"Clearing all workflows from n8n instance at http://localhost:50000..."}
{"level":30,"time":1765549995766,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995766,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995772,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995787,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995792,"pid":47930,"msg":"Failed to delete workflow qIII1VhLAyQfnjIq (Simple Workflow 1): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":40,"time":1765549995800,"pid":47930,"msg":"Failed to delete workflow e1cuvMOI2XFVkW2F (Simple Workflow 2): Status 400 - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995800,"pid":47930,"msg":"âœ… Deleted 0 workflow(s)"}
{"level":30,"time":1765549995800,"pid":47930,"msg":"Using session cookie authentication for http://localhost:50000 (cookie length: 339)"}
{"level":30,"time":1765549995800,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995805,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995826,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
{"level":40,"time":1765549995826,"pid":47930,"msg":"âš ï¸  2 workflow(s) still present after reset"}
{"level":30,"time":1765549995826,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995826,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995826,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995826,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995838,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow qIII1VhLAyQfnjIq"}
{"level":50,"time":1765549995838,"pid":47930,"msg":"Failed to force-delete workflow qIII1VhLAyQfnjIq: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995838,"pid":47930,"msg":"Creating API client for http://localhost:50000/rest"}
{"level":30,"time":1765549995838,"pid":47930,"msg":"Auth method: apiKey=missing, sessionCookie=present"}
{"level":30,"time":1765549995838,"pid":47930,"msg":"Session cookie preview: n8n-auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJp..."}
{"level":30,"time":1765549995838,"pid":47930,"msg":"Using session cookie authentication with /rest endpoints (Cookie header set)"}
{"level":50,"time":1765549995846,"pid":47930,"error":{"status":400,"statusText":"Bad Request","errorMessage":"Workflow must be archived before it can be deleted.","errorDetails":"{\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"},"msg":"Delete failed for workflow e1cuvMOI2XFVkW2F"}
{"level":50,"time":1765549995846,"pid":47930,"msg":"Failed to force-delete workflow e1cuvMOI2XFVkW2F: Failed to delete workflow: 400 Workflow must be archived before it can be deleted. - {\"code\":400,\"message\":\"Workflow must be archived before it can be deleted.\"}"}
{"level":30,"time":1765549995846,"pid":47930,"msg":"Using /rest endpoint - will fetch workflow summaries first, then full data for each"}
{"level":30,"time":1765549995852,"pid":47930,"msg":"Found 2 workflow(s) in summary, fetching full data for each..."}
{"level":30,"time":1765549995869,"pid":47930,"msg":"Total workflows fetched with full data: 2"}
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests
ğŸ§¹ Cleaning up shared n8n instance...

{"level":50,"time":1765549995869,"pid":47930,"err":{"type":"Error","message":"Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2","stack":"Error: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2\n    at Module.resetN8nState (/Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/utils/backup-restore-test.ts:719:15)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at /Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/src/tests/integration/backup-restore.test.ts:88:5\n    at callSuiteHook (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:964:22)\n    at runTest (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1040:30)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runSuite (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1205:15)\n    at runFiles (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1262:5)\n    at startTests (file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/@vitest/runner/dist/index.js:1271:3)\n    at file:///Users/nipuna/Software/paragon-os/paragon-os-app/n8n-agent/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11"},"msg":"Failed to reset n8n state:"}
{"level":30,"time":1765549995870,"pid":47930,"msg":"Removing n8n instance: n8n-test-1765549975016-6zlgjp"}
 â¯ src/tests/integration/backup-restore.test.ts (5 tests | 4 failed) 22435ms
   âœ“ Backup/Restore Integration Tests > should backup and restore simple workflows 452ms
   Ã— Backup/Restore Integration Tests > should backup and restore workflows with references 102ms
     â†’ Failed to reset n8n state: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2
   Ã— Backup/Restore Integration Tests > should handle multiple restore cycles without duplicates 100ms
     â†’ Failed to reset n8n state: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2
   Ã— Backup/Restore Integration Tests > should handle empty backup restore gracefully 96ms
     â†’ Failed to reset n8n state: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2
   Ã— Backup/Restore Integration Tests > should preserve complex workflow structure 105ms
     â†’ Failed to reset n8n state: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2
stdout | src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests
âœ… Cleanup complete


â¯â¯â¯â¯â¯â¯â¯ Failed Tests 4 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should backup and restore workflows with references
 FAIL  src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should handle multiple restore cycles without duplicates
 FAIL  src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should handle empty backup restore gracefully
 FAIL  src/tests/integration/backup-restore.test.ts > Backup/Restore Integration Tests > should preserve complex workflow structure
Error: Failed to reset n8n state: Failed to reset state: 2 workflow(s) still present after force cleanup. Names: Simple Workflow 1, Simple Workflow 2
 â¯ Module.resetN8nState src/utils/backup-restore-test.ts:729:11
    727|   } catch (error) {
    728|     logger.error('Failed to reset n8n state:', error);
    729|     throw new Error(`Failed to reset n8n state: ${error instanceof Errâ€¦
       |           ^
    730|   }
    731| }
 â¯ src/tests/integration/backup-restore.test.ts:88:5

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯

 Test Files  1 failed (1)
      Tests  4 failed | 1 passed (5)
   Start at  20:02:54
   Duration  22.78s (transform 133ms, setup 0ms, collect 225ms, tests 22.44s, environment 0ms, prepare 32ms)

[1;33mğŸ§¹ Cleaning up test containers...[0m
[0;32mâœ… Cleanup complete[0m
