{
  "updatedAt": "2025-12-09T01:35:04.915Z",
  "createdAt": "2025-12-09T01:23:34.311Z",
  "id": "JMnEZrwyIDla9X7y",
  "name": "[LEGACY] Telegram MCP Client Sequencer",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1184,
        432
      ],
      "id": "98f0b3b2-dfa1-43da-b7a3-e7ed90e2463b",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "NIhZoi9otQV2vaAP",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        -2144,
        -160
      ],
      "id": "50c3a471-932b-4b08-836f-cdaf98d52276",
      "name": "List MCP Tools",
      "credentials": {
        "mcpClientApi": {
          "id": "aiYCclLDUqob5iQ0",
          "name": "Telegram MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeTool",
        "toolName": "=telegram_list_contacts",
        "toolParameters": "={}"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        -2144,
        -464
      ],
      "id": "24be1123-dbf6-4fdc-9596-9280141b5dfc",
      "name": "List Contacts",
      "credentials": {
        "mcpClientApi": {
          "id": "aiYCclLDUqob5iQ0",
          "name": "Telegram MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\nlet rawContacts = [];\n\ntry {\n  // Handle MCP response format (from List Contacts)\n  if (input.result && input.result.content && input.result.content[0]) {\n    const parsed = JSON.parse(input.result.content[0].text);\n    rawContacts = parsed?.contacts || [];\n  }\n  // Handle cache format (direct from cache)\n  else if (input.contacts) {\n    rawContacts = Array.isArray(input.contacts) ? input.contacts : [];\n  }\n  // Handle cache output format (from cache system)\n  else if (input.output && input.output.contacts) {\n    rawContacts = Array.isArray(input.output.contacts) ? input.output.contacts : [];\n  }\n  \n  // Validate: if empty or invalid, return empty array\n  if (!Array.isArray(rawContacts) || rawContacts.length === 0) {\n    return {\n      output: {\n        contacts: []\n      },\n      error: 'No valid contacts found',\n      shouldFetch: true\n    };\n  }\n  \n  return {\n    output: {\n      contacts: rawContacts.map(contact=>(contact))\n    }\n  };\n} catch (error) {\n  return {\n    output: {\n      contacts: []\n    },\n    error: error?.message,\n    shouldFetch: true\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1920,
        -448
      ],
      "id": "4d4adcb0-23ce-45ab-9318-d79e899d0ea7",
      "name": "Contact Data Simplifier"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.executionSteps",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -352,
        64
      ],
      "id": "158017ea-9dce-4ef8-9ccf-611df36a0c3d",
      "name": "Split Out"
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first().json;\n\n// Handle error cases (from onError: continueErrorOutput)\nif (item.error) {\n  // Extract error message safely - handle both object and string errors\n  let errorMessage = '';\n  if (typeof item.error === 'string') {\n    errorMessage = item.error;\n  } else if (item.error && typeof item.error === 'object') {\n    errorMessage = item.error.message || item.error.toString() || JSON.stringify(item.error);\n  } else {\n    errorMessage = String(item.error || 'Unknown error');\n  }\n  \n  // Always return a proper object structure (never return strings directly)\n  return {\n    error: errorMessage,\n    toolName: item.toolName || 'unknown',\n    callParams: item.callParams || {},\n    success: false\n  };\n}\n\n// Handle success cases\ntry {\n  if (item.result && item.result.content && item.result.content[0]) {\n    return JSON.parse(item.result.content[0].text);\n  }\n  return item;\n} catch (error) {\n  // Ensure catch block also returns proper object structure\n  return {\n    error: error.message || String(error),\n    result: item,\n    success: false\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        320,
        112
      ],
      "id": "925240b1-a69b-4a66-83ea-b453a0da853b",
      "name": "Execution Data Aggregator"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tfSCD7ysSOdQZac1",
          "mode": "list",
          "cachedResultUrl": "/workflow/tfSCD7ysSOdQZac1",
          "cachedResultName": "[HELPERS] Global Cache System"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "cacheKey": "telegramChats",
            "trueToWrite": false,
            "writeTTLms": 0
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "trueToWrite",
              "displayName": "trueToWrite",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean",
              "removed": false
            },
            {
              "id": "cacheKey",
              "displayName": "cacheKey",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "writeValue",
              "displayName": "writeValue",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "writeTTLms",
              "displayName": "writeTTLms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -2368,
        240
      ],
      "id": "971c3e4a-63ab-474e-b3c6-615e00fe910d",
      "name": "Check Chat Cache",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tfSCD7ysSOdQZac1",
          "mode": "list",
          "cachedResultUrl": "/workflow/tfSCD7ysSOdQZac1",
          "cachedResultName": "[HELPERS] Global Cache System"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "writeTTLms": 1000000,
            "cacheKey": "telegramChats",
            "writeValue": "={{ $json.output }}",
            "trueToWrite": true
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "trueToWrite",
              "displayName": "trueToWrite",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean",
              "removed": false
            },
            {
              "id": "cacheKey",
              "displayName": "cacheKey",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "writeValue",
              "displayName": "writeValue",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "writeTTLms",
              "displayName": "writeTTLms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -1696,
        384
      ],
      "id": "89b57a73-6ac7-4426-9e91-b5a4b42766eb",
      "name": "Update Chat Cache"
    },
    {
      "parameters": {
        "jsCode": "let rawChats = JSON.parse($input.first().json.result.content[0].text)?.items;\n\ntry {  \n  return {\n    output: {\n      chats: rawChats.map(chat=>(chat))\n    }\n  };\n} catch (error) {\n  return {\n    output: {\n      chats: []\n    },\n    error: error.message,\n    shouldFetch: true\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1920,
        384
      ],
      "id": "0b187c38-2bb1-411e-922a-e419a7382866",
      "name": "Chat Data Simplifier"
    },
    {
      "parameters": {
        "operation": "executeTool",
        "toolName": "=telegram_list_chats",
        "toolParameters": "={}"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        -2144,
        384
      ],
      "id": "550a43c2-3628-4cb0-89f6-ac9bffdbfc57",
      "name": "List Chats",
      "credentials": {
        "mcpClientApi": {
          "id": "aiYCclLDUqob5iQ0",
          "name": "Telegram MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tfSCD7ysSOdQZac1",
          "mode": "list",
          "cachedResultUrl": "/workflow/tfSCD7ysSOdQZac1",
          "cachedResultName": "[HELPERS] Global Cache System"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "cacheKey": "telegramTools",
            "trueToWrite": false,
            "writeTTLms": 0
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "trueToWrite",
              "displayName": "trueToWrite",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean",
              "removed": false
            },
            {
              "id": "cacheKey",
              "displayName": "cacheKey",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "writeValue",
              "displayName": "writeValue",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "writeTTLms",
              "displayName": "writeTTLms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -2368,
        -160
      ],
      "id": "973426ee-798e-47a9-9e51-173980fa6114",
      "name": "Check Tool Cache",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tfSCD7ysSOdQZac1",
          "mode": "list",
          "cachedResultUrl": "/workflow/tfSCD7ysSOdQZac1",
          "cachedResultName": "[HELPERS] Global Cache System"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "cacheKey": "telegramContacts",
            "trueToWrite": false,
            "writeTTLms": 0
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "trueToWrite",
              "displayName": "trueToWrite",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean",
              "removed": false
            },
            {
              "id": "cacheKey",
              "displayName": "cacheKey",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "writeValue",
              "displayName": "writeValue",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "writeTTLms",
              "displayName": "writeTTLms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -2368,
        -448
      ],
      "id": "177002c1-19d8-4be1-a967-2328b043dc20",
      "name": "Check Contact Cache",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\n\n// Validate cache result - check if tools exist and is valid\nif (!input || !input.tools || (Array.isArray(input.tools) && input.tools.length === 0) || (typeof input.tools === 'object' && Object.keys(input.tools).length === 0)) {\n  // Invalid/empty cache - return error to trigger fetch\n  return {\n    error: 'Invalid or empty cache result',\n    shouldFetch: true,\n    output: { tools: [] }\n  };\n}\n\nreturn {\n  output: {\n    tools: input.tools\n  }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1920,
        -160
      ],
      "id": "98e14d20-1330-475c-a8b1-1365e8b5a9b8",
      "name": "Tool Data Simplifier"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tfSCD7ysSOdQZac1",
          "mode": "list",
          "cachedResultUrl": "/workflow/tfSCD7ysSOdQZac1",
          "cachedResultName": "[HELPERS] Global Cache System"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "writeTTLms": 1000000,
            "cacheKey": "telegramTools",
            "writeValue": "={{ $json.output }}",
            "trueToWrite": true
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "trueToWrite",
              "displayName": "trueToWrite",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean",
              "removed": false
            },
            {
              "id": "cacheKey",
              "displayName": "cacheKey",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "writeValue",
              "displayName": "writeValue",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "writeTTLms",
              "displayName": "writeTTLms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -1696,
        -160
      ],
      "id": "1025078b-69b3-4c02-bf39-f0e3bb71c9c2",
      "name": "Update Tool Cache"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tfSCD7ysSOdQZac1",
          "mode": "list",
          "cachedResultUrl": "/workflow/tfSCD7ysSOdQZac1",
          "cachedResultName": "[HELPERS] Global Cache System"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "writeTTLms": 1000000,
            "cacheKey": "telegramContacts",
            "writeValue": "={{ $json.output }}",
            "trueToWrite": true
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "trueToWrite",
              "displayName": "trueToWrite",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean",
              "removed": false
            },
            {
              "id": "cacheKey",
              "displayName": "cacheKey",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "writeValue",
              "displayName": "writeValue",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "writeTTLms",
              "displayName": "writeTTLms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -1696,
        -464
      ],
      "id": "612c1d56-4ca4-4397-b382-66753963fef9",
      "name": "Update Contact Cache"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 4,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1472,
        -48
      ],
      "id": "2ade36f9-e9b1-4cee-aeff-3a19294d28b3",
      "name": "Context Aggregator"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Provided task is \"{{ $json.userPrompt }}\". Break it down to achievable action steps.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## You are a helpful assistant with the capabilities to generate a direct answer to a user's prompt, or a sequential JSON array of tool execution steps to accomplish the task. \n\nVERY IMPORTANT INSTRUCTIONS: \n\n1. Telegram GROUPS have negative channelIDs and Direct messages have positive channelIDs. when using a channelId as a parameter, pay attention to add the `-` prefix.\n2. For tool `telegram_list_chats`: telegram chat (channel) types MUST BE ONE OF `user`, `group`, `supergroup`.\n3. Use \"telegram_search_public_chats\" ONLY when you are asked to search globally. otherwise Always look in contacts instead.\n\nInstructions:\n- use the following contact list instead of calling 'telegram_list_contacts'\n- use the following chats list instead of calling 'telegram_list_chats'\n\nIMPORTANT: Use directAnswer ONLY for informational questions that can be answered from the provided context (contacts, chats, tools lists). \n\nFor ANY operation that requires Telegram API calls, you MUST use executionSteps:\n- Reading/list/get operations (list messages, read channel, get user info, etc.)\n- Writing/send operations (send message, etc.)\n- Finding/searching operations (find channel, search messages, etc.)\n- Any action that retrieves or modifies Telegram data\n\nExamples:\n- \"list messages with user X\" → MUST use executionSteps (call telegram_read_channel or similar tool)\n- \"send a message to channel Y\" → MUST use executionSteps\n- \"what tools are available?\" → Can use directAnswer (from tools list)\n- \"who are my contacts?\" → Can use directAnswer (from contacts list)\n\n{{ $json.tools ? $json.tools.toJsonString() : '[]' }}\n\n## Available contacts:\n\n{{ $json.contacts ? $json.contacts.toJsonString() : '[]' }}\n\n## My Chats:\n\n{{ $json.chats ? $json.chats.toJsonString() : '[]' }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -1248,
        -16
      ],
      "id": "9cc503eb-236d-4d47-bdcb-0c0c718d5224",
      "name": "Execution Planner AI Agent"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"executionSteps\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"toolName\": {\n            \"type\": \"string\"\n          },\n          \"callParams\": {\n            \"type\": \"object\"\n          }\n        },\n        \"required\": [\"toolName\", \"callParams\"],\n        \"additionalProperties\": false\n      },\n      \"description\": \"List MCP tool execution steps to achieve user's goal\"\n    },\n    \"directAnswer\": {\n      \"type\": \"object\",\n      \"description\": \"You can provide a direct answer without providing a list of executionSteps\"\n    }\n  },\n  \"additionalProperties\": false\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -1168,
        224
      ],
      "id": "c9fba54f-cb93-4f24-8552-e6c596be1d2a",
      "name": "Execution Plan Output Parser"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ !!$json.output.directAnswer?.toJsonString() }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "ff6241e7-5888-44d3-bcd7-543a0deffafe"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "HAS DIRECT ANSWER"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5093fd74-cc07-45b4-8725-2d1de4075919",
                    "leftValue": "={{ $json.output.executionSteps ?? [] }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "HAS EXECUTION STEPS"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -800,
        -16
      ],
      "id": "40e0f9d1-d5ef-4c1b-a8f2-e4e32e3c7fe9",
      "name": "Has a direct answer?"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {
          "includeUnpaired": true
        }
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        96,
        -176
      ],
      "id": "8c6ed802-b50b-4391-a2e5-a4f77ec26314",
      "name": "Final Response"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "497d547e-48e4-4218-a02e-9648db9a4c93",
              "name": "output.executionSteps",
              "value": "={{ $json.output.executionSteps ?? [] }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -576,
        64
      ],
      "id": "1167ffee-e227-488a-be1d-d913ba329b47",
      "name": "Prepare Execution Steps"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -128,
        64
      ],
      "id": "bca7a24a-5d7b-4047-84a4-eb680a520084",
      "name": "Loop Over MCP Execution Steps"
    },
    {
      "parameters": {
        "operation": "executeTool",
        "toolName": "={{ $json.toolName }}",
        "toolParameters": "={{ $json.callParams }}"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        96,
        48
      ],
      "id": "a09fb8ec-e0f8-4abe-8d06-167882c25b9e",
      "name": "MCP Sequence Executor",
      "credentials": {
        "mcpClientApi": {
          "id": "aiYCclLDUqob5iQ0",
          "name": "Telegram MCP Client (STDIO) account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -2592,
        -80
      ],
      "id": "e0aa129f-352b-4854-ad37-896116cdbc33",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "userPrompt"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -2816,
        -80
      ],
      "id": "ff346de8-bd77-4883-ae44-a52eaed26a9f",
      "name": "When Executed by Another Workflow"
    }
  ],
  "connections": {
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Execution Planner AI Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Execution Plan Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "List MCP Tools": {
      "main": [
        [
          {
            "node": "Tool Data Simplifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Contacts": {
      "main": [
        [
          {
            "node": "Contact Data Simplifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contact Data Simplifier": {
      "main": [
        [
          {
            "node": "Update Contact Cache",
            "type": "main",
            "index": 0
          },
          {
            "node": "Context Aggregator",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over MCP Execution Steps",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data Aggregator": {
      "main": [
        [
          {
            "node": "Loop Over MCP Execution Steps",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Chat Cache": {
      "main": [
        [
          {
            "node": "Context Aggregator",
            "type": "main",
            "index": 3
          }
        ],
        [
          {
            "node": "List Chats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Chat Cache": {
      "main": [
        [
          {
            "node": "Context Aggregator",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Chat Data Simplifier": {
      "main": [
        [
          {
            "node": "Update Chat Cache",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Chats": {
      "main": [
        [
          {
            "node": "Chat Data Simplifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Tool Cache": {
      "main": [
        [
          {
            "node": "Context Aggregator",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "List MCP Tools",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Contact Cache": {
      "main": [
        [
          {
            "node": "Contact Data Simplifier",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "List Contacts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tool Data Simplifier": {
      "main": [
        [
          {
            "node": "Update Tool Cache",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Tool Cache": {
      "main": [
        [
          {
            "node": "Context Aggregator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Contact Cache": {
      "main": [
        [
          {
            "node": "Context Aggregator",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Context Aggregator": {
      "main": [
        [
          {
            "node": "Execution Planner AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Planner AI Agent": {
      "main": [
        [
          {
            "node": "Has a direct answer?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Plan Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Execution Planner AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Has a direct answer?": {
      "main": [
        [
          {
            "node": "Final Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Execution Steps",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Execution Steps": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over MCP Execution Steps": {
      "main": [
        [
          {
            "node": "Final Response",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "MCP Sequence Executor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Sequence Executor": {
      "main": [
        [
          {
            "node": "Execution Data Aggregator",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execution Data Aggregator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "Check Contact Cache",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check Tool Cache",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check Chat Cache",
            "type": "main",
            "index": 0
          },
          {
            "node": "Context Aggregator",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": null,
  "versionId": "03893c54-8eb3-4fe9-a43e-1e025205ef84",
  "activeVersionId": null,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-12-09T01:23:34.311Z",
      "createdAt": "2025-12-09T01:23:34.311Z",
      "role": "workflow:owner",
      "workflowId": "JMnEZrwyIDla9X7y",
      "projectId": "GEUEn6ArNROzJ5FY"
    }
  ],
  "activeVersion": null,
  "tags": []
}
