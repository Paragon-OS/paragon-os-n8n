{
  "updatedAt": "2025-12-09T00:13:59.606Z",
  "createdAt": "2025-12-08T23:57:04.394Z",
  "id": "lJlPkH9jUM8fVIvQ",
  "name": "[LAB] Discord Contact CRUD Agent",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.discordContactsRelatedPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an expert assistant for managing Discord user records in a DataTable. Your role is to help users perform CRUD (Create, Read, Update, Delete) operations on user records.\n\n**Available Operations:**\n1. **Create** - Add a new Discord user record with discord_id, username, display_name, and last_messaged\n2. **Read/Search** - Retrieve user records by searching discord_id, username, or display_name\n3. **Update** - Modify existing user records by discord_id (can update username, display_name, last_messaged)\n4. **Delete** - Remove a user record by discord_id\n\n**DataTable Schema:**\n- discord_id (string, required, unique identifier)\n- username (string)\n- display_name (string)\n- createdAt (auto-managed timestamp)\n- updatedAt (auto-managed timestamp)\n\n**Guidelines:**\n- Remember that query input user name might not be correct. \n- Check your MEMORY first for even for close matches, and if not found you must use the 'profile fetcher' and find the best match.\n- Fetching a profile must only be done if there are no matches in the db.\n- If you fetch & remember a user who is not in the DB, add the user to DB.\n- Always extract exact parameter values from user requests (discord_id, username, display_name, last_messaged)\n- For Create operations: require discord_id, optionally include username, display_name, last_messaged\n- For Read operations: use search_query parameter to search across discord_id, username, or display_name\n- For Update operations: require discord_id, include fields to update (username, display_name, last_messaged)\n- For Delete operations: require discord_id\n- Validate that discord_id is provided for Create, Update, and Delete operations\n- Provide clear, helpful responses after each operation\n- Handle errors gracefully and suggest corrections if validation fails\n- When multiple records match a search, return all matching records"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        32,
        -192
      ],
      "id": "ec6db855-e1d5-4860-9038-fedf88f36afb",
      "name": "CRUD AI Agent"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        160,
        240
      ],
      "id": "4d2a297c-13f4-48c0-a882-17b0f04b8edb",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "NIhZoi9otQV2vaAP",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "aqMjQOYOqhSGVImr",
          "mode": "list",
          "cachedResultName": "Paragon's Discord Contacts",
          "cachedResultUrl": "/projects/GEUEn6ArNROzJ5FY/datatables/aqMjQOYOqhSGVImr"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "discord_id",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', `exact user discord ID`, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        -96,
        32
      ],
      "id": "8a56bdb2-5ebf-4197-8e95-4ad7881baa6b",
      "name": "Get row(s) in Data table"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "aqMjQOYOqhSGVImr",
          "mode": "list",
          "cachedResultName": "Paragon's Discord Contacts",
          "cachedResultUrl": "/projects/GEUEn6ArNROzJ5FY/datatables/aqMjQOYOqhSGVImr"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "discord_id",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', `exact discord user ID`, 'string') }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "discord_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('discord_id', ``, 'string') }}",
            "username": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('username', ``, 'string') }}",
            "display_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('display_name', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "discord_id",
              "displayName": "discord_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "display_name",
              "displayName": "display_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        32,
        32
      ],
      "id": "58281cc9-526a-498e-9456-7859f79f0805",
      "name": "Update row(s) in Data table"
    },
    {
      "parameters": {
        "operation": "deleteRows",
        "dataTableId": {
          "__rl": true,
          "value": "aqMjQOYOqhSGVImr",
          "mode": "list",
          "cachedResultName": "Paragon's Discord Contacts",
          "cachedResultUrl": "/projects/GEUEn6ArNROzJ5FY/datatables/aqMjQOYOqhSGVImr"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "discord_id",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', `exact user discord ID`, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        160,
        32
      ],
      "id": "b20f606a-60e6-4009-b4c3-0fd486bcee09",
      "name": "Delete row(s) in Data table"
    },
    {
      "parameters": {
        "description": "Call this tool to retrieve a user profile from a discord username or user ID",
        "workflowId": {
          "__rl": true,
          "value": "Hevq2OHYHYHTlc6K",
          "mode": "list",
          "cachedResultUrl": "/workflow/Hevq2OHYHYHTlc6K",
          "cachedResultName": "[LAB] Discord MCP Client"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "discordRelatedPrompt": "=Fetch profile of the user {{ $fromAI('userId', ``, 'string') }}."
          },
          "matchingColumns": [
            "discordRelatedPrompt"
          ],
          "schema": [
            {
              "id": "discordRelatedPrompt",
              "displayName": "discordRelatedPrompt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        288,
        32
      ],
      "id": "a71b58e4-b955-4d64-b989-5ca26aed71ef",
      "name": "Fetch a user profile"
    },
    {
      "parameters": {
        "operation": "upsert",
        "dataTableId": {
          "__rl": true,
          "value": "aqMjQOYOqhSGVImr",
          "mode": "list",
          "cachedResultName": "Paragon's Discord Contacts",
          "cachedResultUrl": "/projects/GEUEn6ArNROzJ5FY/datatables/aqMjQOYOqhSGVImr"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "discord_id",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', `exact Discord ID from fetched user profile`, 'string') }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "discord_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('discord_id', ``, 'string') }}",
            "username": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('username', ``, 'string') }}",
            "display_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('display_name', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "discord_id",
              "displayName": "discord_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "display_name",
              "displayName": "display_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        416,
        32
      ],
      "id": "21996233-aee8-44e9-9ca3-60d22e581a37",
      "name": "Upsert row(s) in Data table"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $workflow.id }} v1",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -224,
        32
      ],
      "id": "aadf0be1-5309-4b69-8914-0aae2f22cd0b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "discordContactsRelatedPrompt"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -448,
        -192
      ],
      "id": "accb9a21-d7ff-432f-8c77-3121f2474e1d",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"status\": {\n      \"type\": \"string\",\n      \"enum\": [\"success\", \"error\", \"not_found\", \"partial\"],\n      \"description\": \"Status of the operation\"\n    },\n    \"data\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"contact\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"discord_id\": {\n              \"type\": \"string\",\n              \"description\": \"Discord user ID\"\n            },\n            \"username\": {\n              \"type\": \"string\",\n              \"description\": \"Discord username\"\n            },\n            \"display_name\": {\n              \"type\": \"string\",\n              \"description\": \"Display name\"\n            }\n          },\n          \"required\": [\"discord_id\", \"username\"]\n        }\n      }\n    }\n  },\n  \"required\": [\"status\", \"data\"]\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        544,
        32
      ],
      "id": "1055062d-8431-4ffb-bb10-8e6b63a65d52",
      "name": "Structured Output Parser"
    }
  ],
  "connections": {
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in Data table": {
      "ai_tool": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update row(s) in Data table": {
      "ai_tool": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Delete row(s) in Data table": {
      "ai_tool": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Fetch a user profile": {
      "ai_tool": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Upsert row(s) in Data table": {
      "ai_tool": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "CRUD AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": null,
  "versionId": "6d8cf113-da20-4834-8acd-290543486267",
  "activeVersionId": null,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-12-08T23:57:04.395Z",
      "createdAt": "2025-12-08T23:57:04.395Z",
      "role": "workflow:owner",
      "workflowId": "lJlPkH9jUM8fVIvQ",
      "projectId": "GEUEn6ArNROzJ5FY"
    }
  ],
  "activeVersion": null,
  "tags": []
}
