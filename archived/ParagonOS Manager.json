{
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -144,
        -208
      ],
      "id": "57f9691c-c485-4f8f-a71c-ac976640cd42",
      "name": "When chat message received",
      "webhookId": "171c216b-baf1-4dfc-b52e-280926480ed7"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        80,
        112
      ],
      "id": "4f257b85-9424-45f4-9cbe-37d36c785363",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "NIhZoi9otQV2vaAP",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "description": "Executes Discord operations. Supports both single operations and multi-step sequential operations.\n\nSINGLE operations (examples):\n- \"find channel ID for dev-chat in metarune homies guild\"\n- \"send message 'hello' to channel ID 1234567890\"\n- \"list all channels in metarune homies guild\"\n- \"list all guilds i'm in\"\n\nMULTI-STEP operations (the tool will break these down automatically):\n- \"find dev-chat channel and send a message\" ✓\n- \"get channel ID for general then send message 'hello'\" ✓\n- \"list members in server X and find user Y\" ✓\n\nThe tool intelligently plans and executes sequences of Discord operations. For multi-step operations, it will automatically break them down, execute steps sequentially, and pass data between steps.\n\n# Capabilities: \n\nThe Discord MCP tools enable comprehensive Discord integration including reading messages from channels and DMs (with pagination and date filtering), searching message content, sending/editing/deleting messages with file attachment support, downloading attachments, and managing server/channel access. You can list guilds/servers you are part of, list channels, contacts, member counts and guild/server members, search for specific contacts, configure whitelist/blacklist filters for channels and DMs, and retrieve pending channels or DMs that need attention (unread messages or mentions). The tools support both server channels and direct messages, with automatic DM channel creation when sending to users.",
        "workflowId": {
          "__rl": true,
          "value": "vfcxqLBDDMKL5lnG",
          "mode": "list",
          "cachedResultUrl": "/workflow/vfcxqLBDDMKL5lnG",
          "cachedResultName": "Discord MCP Client Sequencer"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "userPrompt": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('userPrompt', `Independent prompt in natural language`, 'string') }}"
          },
          "matchingColumns": [
            "userPrompt"
          ],
          "schema": [
            {
              "id": "userPrompt",
              "displayName": "userPrompt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        336,
        112
      ],
      "id": "f730fc6b-cee7-4f4c-a3fc-d57f2a184361",
      "name": "Discord Agent with Caching"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $workflow.id }} v6"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        208,
        112
      ],
      "id": "05b63032-72a4-446e-b412-4858c72ee5cf",
      "name": "Conversation Memory"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "You are a Discord manager that can perform operations and analysis tasks.\n\nOPERATIONS - Break down tasks into sequential, independent steps:\n1. Multi-step instructions to the Discord tool must be independent and NOT expect data from the previous steps.\n2. Each tool call must be completely self-contained with ALL necessary information\n3. When you need information from a previous step, YOU must extract it and pass it explicitly in the next call\n\nANALYSIS TASKS - You can analyze data from Discord:\n- For questions like \"am I a frequent chatter this week?\", you should:\n  1. AUTOMATICALLY get the user's Discord user ID using available tools - DO NOT ask the user for it\n     - Use \"list contacts\" or check available contact/user context to find the current user's ID\n     - When user asks about themselves (\"am I...\", \"my...\"), automatically identify their user ID from contacts\n  2. Use Discord tools to read messages from channels/DMs with date filtering for \"this week\"\n  3. Filter/count messages from that user\n  4. Analyze the data to determine frequency (e.g., compare to average, use reasonable thresholds)\n  5. Provide a clear answer with supporting data\n\nEXAMPLES:\n- Operation: \"say hi to dev-chat in metarune homies guild\"\n  Step 1: \"find the channel ID for dev-chat in metarune homies guild\"\n  Step 2: Extract channel ID, then \"send message 'hi' to channel ID 1234567890\"\n  \n- Analysis: \"am I a frequent chatter this week?\"\n  Step 1: Automatically get your user ID from contacts (use \"list contacts\" tool if needed, do NOT ask user)\n  Step 2: Read messages from relevant channels/DMs filtered to this week\n  Step 3: Count messages from your user ID\n  Step 4: Determine if count indicates \"frequent\" (e.g., >10 messages/day average, or >50 total)\n  Step 5: Provide answer with count and reasoning\n\nAlways specify IDs explicitly when sending messages - never use channel names in send commands."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        136,
        -112
      ],
      "id": "02c424e5-f860-4a00-b183-22788404de56",
      "name": "Metarune Admin Chat Agent"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "chatInput"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -144,
        -16
      ],
      "id": "2ae37ba4-4d48-47fe-9793-46b1af6ed914",
      "name": "When Executed by Another Workflow"
    }
  ],
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Metarune Admin Chat Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Metarune Admin Chat Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Discord Agent with Caching": {
      "ai_tool": [
        [
          {
            "node": "Metarune Admin Chat Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "Metarune Admin Chat Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Metarune Admin Chat Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "cd381b17813b1f32bbed6ff56a914eb5679cd0e7bd9a8ef4580ebc82f8011b84"
  }
}